# Задание
Представь, что тимлид поручил тебе написать простой микросервис на Python, который будет выполнять роль ботофермы.

### Что такое ботоферма?
Ботоферма - сервис, который отдает реальные креды пользователя, чтобы использовать его в E2E-тестах для проверки работоспособности функционала. 
К примеру, есть веб-магазин по продаже корма и аксессуаров для животных, и есть пользователь, который может зарегистрироваться в этом магазине.
После выполнения авторизации пользователь может взаимодействовать с магазином: выбирать различные товары, их количество, их свойства, класть в корзину и так далее.
Мы, как разработчики, заинтересованы в тестировании функционала "наживую", чтобы отлавливать баги, улучшать функционал, чтобы пользователь был доволен и приносил нам деньги.
Для этого нам нужен "пользователь", который мог бы авторизоваться в нашем магазине, и, выполняя определенные запросы, а под запросами подразумеваются уже REST-запросы в бэкенд, эмулировал реальную работу. Ботоферма как раз реализует "выдачу" этого пользователя, которого уже будет использовать платформа для тестирования.

### Что требуется сделать?
Написать Restful-сервис на Python с использованием FastAPI в качестве веб-фреймворка, SQLAlchemy в качестве ORM, который бы создавал нового пользователя в ботоферме, выдавал список всех существующих пользователей, а также блокировал пользователя для его использования в рамках E2E-теста.

### Что такое блокировка?
Если потребуется выдать пользователя для E2E-теста - мы должны повесить на него временную метку (locktime), когда этот пользователь был выдан, чтобы понимать, что сейчас этот пользователь занят, и его нельзя выдать для другого E2E-теста.

### Если более формально:
- реализовать метод create_user - создать нового пользователя в ботоферме;
- реализовать метод get_users - получить список всех существующих пользователей;
- реализовать метод acquire_lock - который бы накладывал блокировку;
- реализовать метод release_lock - который бы снимал блокировку (обнулял locktime).

### Особенности&nbsp;acquire_lock/release_lock:
В метод должен быть передан id пользователя, которого нужно заблокировать/освободить. Если пользователь уже заблокирован - нужно выдавать ответ, что данный пользователь занят.

### Сущности:
USER:
- id - UUID пользователя;
- created_ad - дата создания пользователя;
- login - почтовый адрес пользователя;
- password - пароль пользователя (должен хранится в зашифрованном виде);
- project_id - UUID проекта, к которому принадлежит пользователь;
- env - название окружения (prod, preprod, stage);
- domain - тип пользователя (canary, regular);
- locktime - временная метка (timestamp).

### Инструменты:
- FastAPI и uvicorn в качестве ASGI;
- Pydantic версии 1 или 2;
- SQLAlchemy версии 2;
- PostgreSQL версии 14 и выше.
- pytest


# Запуск приложения
При необходимости перед запуском проекта можно склонировать репозиторий:
```
git clone https://github.com/ITSamantha/botfarm
```

Запуск приложения осуществляется посредством запуска представленных ниже команд в директории проекта:
```
docker compose build --no-cache
docker compose up
```
***При запуске приложения в первую очередь проводится ревизия миграций, далее все миграции применяются. После применения миграций сидеры заполняют базу данных некоторыми важными данными для таблиц-характеристик.***

# Особенности разработанного микросервиса
1. Сервис использует механизмы авторизации login и выхода из аккаунта logout. Данный механизм реализован с помощью JWT токена и cookies.
2. Сервис написан в асинхронном стиле с использованием базы данных PostgreSQL и asyncpg.
3. Сервис использует alembic для работы с миграциями базы данных. Работа с миграциями осуществляется при docker compose build в entrypoint.
4. У сервиса имеются пробы (и заглушки для проб:) ).

# Тестирование
Тестирование осуществляется с помощью pytest. Написанные тесты являются прототипом для написания настоящих тестов. Данные тесты, вероятно, даже не пройдут assert. Однако, не хотелось бы оставлять данный пункт из требований совсем не выполненным:)
